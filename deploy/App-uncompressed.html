<!DOCTYPE html>
<html>
<head>
    <title>query-builds</title>

    <script type="text/javascript" src="/apps/2.0rc2/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                /*!
DeftJS 0.9.1

Copyright (c) 2012-2013 [DeftJS Framework Contributors](http://deftjs.org)
Open source under the [MIT License](http://en.wikipedia.org/wiki/MIT_License).
*/

Ext.define("Deft.log.Logger",{alternateClassName:["Deft.Logger"],singleton:true,log:function(b,a){if(a==null){a="info"}},verbose:function(a){this.log(a,"verbose")},info:function(a){this.log(a,"info")},deprecate:function(a){this.log(a,"deprecate")},warn:function(a){this.log(a,"warn")},error:function(a){this.log(a,"error")}},function(){if(Ext.getVersion("extjs")!=null){this.log=function(b,a){if(a==null){a="info"}if(a==="verbose"){a="info"}if(a==="deprecate"){a="warn"}Ext.log({msg:b,level:a})}}else{this.log=function(b,a){if(a==null){a="info"}if((Ext.Logger!=null)&&Ext.isFunction(Ext.Logger.log)){Ext.Logger.log(b,a)}}}});Ext.define("Deft.ioc.DependencyProvider",{config:{identifier:null,className:null,parameters:null,fn:null,value:void 0,singleton:true,eager:false},constructor:function(b){var a;this.initConfig(b);if((b.value!=null)&&b.value.constructor===Object){this.setValue(b.value)}if(this.getEager()){if(this.getValue()!=null){Ext.Error.raise({msg:"Error while configuring '"+(this.getIdentifier())+"': a 'value' cannot be created eagerly."})}if(!this.getSingleton()){Ext.Error.raise({msg:"Error while configuring '"+(this.getIdentifier())+"': only singletons can be created eagerly."})}}if(this.getClassName()!=null){a=Ext.ClassManager.get(this.getClassName());if(a==null){Deft.Logger.warn("Synchronously loading '"+(this.getClassName())+"'; consider adding Ext.require('"+(this.getClassName())+"') above Ext.onReady.");Ext.syncRequire(this.getClassName());a=Ext.ClassManager.get(this.getClassName())}if(a==null){Ext.Error.raise({msg:"Error while configuring rule for '"+(this.getIdentifier())+"': unrecognized class name or alias: '"+(this.getClassName())+"'"})}}if(!this.getSingleton()){if(this.getClassName()!=null){if(Ext.ClassManager.get(this.getClassName()).singleton){Ext.Error.raise({msg:"Error while configuring rule for '"+(this.getIdentifier())+"': singleton classes cannot be configured for injection as a prototype. Consider removing 'singleton: true' from the class definition."})}}if(this.getValue()!=null){Ext.Error.raise({msg:"Error while configuring '"+(this.getIdentifier())+"': a 'value' can only be configured as a singleton."})}}else{if((this.getClassName()!=null)&&(this.getParameters()!=null)){if(Ext.ClassManager.get(this.getClassName()).singleton){Ext.Error.raise({msg:"Error while configuring rule for '"+(this.getIdentifier())+"': parameters cannot be applied to singleton classes. Consider removing 'singleton: true' from the class definition."})}}}return this},resolve:function(d,e){var c,a,b;Deft.Logger.log("Resolving '"+(this.getIdentifier())+"'.");if(this.getValue()!==void 0){return this.getValue()}a=null;if(this.getFn()!=null){Deft.Logger.log("Executing factory function.");if(e){c=[d].concat(Ext.toArray(e))}else{c=[d]}a=this.getFn().apply(Deft.Injector,c)}else{if(this.getClassName()!=null){if(Ext.ClassManager.get(this.getClassName()).singleton){Deft.Logger.log("Using existing singleton instance of '"+(this.getClassName())+"'.");a=Ext.ClassManager.get(this.getClassName())}else{Deft.Logger.log("Creating instance of '"+(this.getClassName())+"'.");b=this.getParameters()!=null?[this.getClassName()].concat(this.getParameters()):[this.getClassName()];a=Ext.create.apply(this,b)}}else{Ext.Error.raise({msg:"Error while configuring rule for '"+(this.getIdentifier())+"': no 'value', 'fn', or 'className' was specified."})}}if(this.getSingleton()){this.setValue(a)}return a}});Ext.define("Deft.ioc.Injector",{alternateClassName:["Deft.Injector"],singleton:true,constructor:function(){this.providers={};this.injectionStack=[];return this},configure:function(b){var a;Deft.Logger.log("Configuring the injector.");a={};Ext.Object.each(b,function(d,c){var e;Deft.Logger.log("Configuring dependency provider for '"+d+"'.");if(Ext.isString(c)){e=Ext.create("Deft.ioc.DependencyProvider",{identifier:d,className:c})}else{e=Ext.create("Deft.ioc.DependencyProvider",Ext.apply({identifier:d},c))}this.providers[d]=e;a[d]=e},this);Ext.Object.each(a,function(c,d){if(d.getEager()){Deft.Logger.log("Eagerly creating '"+(d.getIdentifier())+"'.");d.resolve()}},this)},reset:function(){Deft.Logger.log("Resetting the injector.");this.providers={}},canResolve:function(a){var b;b=this.providers[a];return b!=null},resolve:function(a,b,d){var c;c=this.providers[a];if(c!=null){return c.resolve(b,d)}else{Ext.Error.raise({msg:"Error while resolving value to inject: no dependency provider found for '"+a+"'."})}},inject:function(e,f,k,j){var h,a,b,c,d,i,g;if(j==null){j=true}i=Ext.getClassName(f);if(Ext.Array.contains(this.injectionStack,i)){d=this.injectionStack.join(" -> ");this.injectionStack=[];Ext.Error.raise({msg:"Error resolving dependencies for '"+i+"'. A circular dependency exists in its injections: "+d+" -> *"+i+"*"});return null}this.injectionStack.push(i);h={};if(Ext.isString(e)){e=[e]}Ext.Object.each(e,function(o,p){var n,l,m;m=Ext.isArray(e)?p:o;n=p;l=this.resolve(n,f,k);if(m in f.config){Deft.Logger.log("Injecting '"+n+"' into '"+i+"."+m+"' config.");h[m]=l}else{Deft.Logger.log("Injecting '"+n+"' into '"+i+"."+m+"' property.");f[m]=l}},this);this.injectionStack=[];if(j){for(a in h){g=h[a];c="set"+Ext.String.capitalize(a);f[c].call(f,g)}}else{if((Ext.getVersion("extjs")!=null)&&f instanceof Ext.ClassManager.get("Ext.Component")){f.injectConfig=h}else{if(Ext.isFunction(f.initConfig)){b=f.initConfig;f.initConfig=function(m){var l;l=b.call(this,Ext.Object.merge({},m||{},h));return l}}}}return f}},function(){if(Ext.getVersion("extjs")!=null){if(Ext.getVersion("core").isLessThan("4.1.0")){Ext.Component.override({constructor:function(a){a=Ext.Object.merge({},a||{},this.injectConfig||{});delete this.injectConfig;return this.callOverridden([a])}})}else{Ext.define("Deft.InjectableComponent",{override:"Ext.Component",constructor:function(a){a=Ext.Object.merge({},a||{},this.injectConfig||{});delete this.injectConfig;return this.callParent([a])}})}}});Ext.define("Deft.event.LiveEventListener",{alternateClassName:["Deft.LiveEventListener"],constructor:function(c){var b,d,e,a;Ext.apply(this,c);this.components=[];d=Ext.ComponentQuery.query(this.selector,this.container);for(e=0,a=d.length;e<a;e++){b=d[e];this.components.push(b);b.on(this.eventName,this.fn,this.scope,this.options)}},destroy:function(){var b,d,a,c;c=this.components;for(d=0,a=c.length;d<a;d++){b=c[d];b.un(this.eventName,this.fn,this.scope)}this.components=null},register:function(a){if(this.matches(a)){this.components.push(a);a.on(this.eventName,this.fn,this.scope,this.options)}},unregister:function(b){var a;a=Ext.Array.indexOf(this.components,b);if(a!==-1){b.un(this.eventName,this.fn,this.scope);Ext.Array.erase(this.components,a,1)}},matches:function(a){if(this.selector===null&&this.container===a){return true}if(this.container===null&&Ext.Array.contains(Ext.ComponentQuery.query(this.selector),a)){return true}if(a.isDescendantOf(this.container)&&Ext.Array.contains(this.container.query(this.selector),a)){return true}return false}});Ext.define("Deft.event.LiveEventBus",{alternateClassName:["Deft.LiveEventBus"],singleton:true,constructor:function(){this.listeners=[]},destroy:function(){var d,c,a,b;b=this.listeners;for(c=0,a=b.length;c<a;c++){d=b[c];d.destroy()}this.listeners=null},addListener:function(b,a,c,f,e,d){var g;g=Ext.create("Deft.event.LiveEventListener",{container:b,selector:a,eventName:c,fn:f,scope:e,options:d});this.listeners.push(g)},removeListener:function(b,a,c,e,d){var f;f=this.findListener(b,a,c,e,d);if(f!=null){Ext.Array.remove(this.listeners,f);f.destroy()}},on:function(b,a,c,f,e,d){return this.addListener(b,a,c,f,e,d)},un:function(b,a,c,e,d){return this.removeListener(b,a,c,e,d)},findListener:function(a,c,f,g,i){var b,d,h,e;e=this.listeners;for(d=0,h=e.length;d<h;d++){b=e[d];if(b.container===a&&b.selector===c&&b.eventName===f&&b.fn===g&&b.scope===i){return b}}return null},register:function(a){a.on("added",this.onComponentAdded,this);a.on("removed",this.onComponentRemoved,this)},unregister:function(a){a.un("added",this.onComponentAdded,this);a.un("removed",this.onComponentRemoved,this)},onComponentAdded:function(c,b,d){var g,f,a,e;e=this.listeners;for(f=0,a=e.length;f<a;f++){g=e[f];g.register(c)}},onComponentRemoved:function(c,b,d){var g,f,a,e;e=this.listeners;for(f=0,a=e.length;f<a;f++){g=e[f];g.unregister(c)}}},function(){if(Ext.getVersion("touch")!=null){Ext.define("Deft.Component",{override:"Ext.Component",setParent:function(c){var b,a;b=this.getParent();a=this.callParent(arguments);if(b===null&&c!==null){this.fireEvent("added",this,c)}else{if(b!==null&&c!==null){this.fireEvent("removed",this,b);this.fireEvent("added",this,c)}else{if(b!==null&&c===null){this.fireEvent("removed",this,b)}}}return a},isDescendantOf:function(a){var b;b=this.getParent();while(b!=null){if(b===a){return true}b=b.getParent()}return false}})}Ext.Function.interceptAfter(Ext.ComponentManager,"register",function(a){Deft.event.LiveEventBus.register(a)});Ext.Function.interceptAfter(Ext.ComponentManager,"unregister",function(a){Deft.event.LiveEventBus.unregister(a)})});Ext.define("Deft.core.Class",{alternateClassName:["Deft.Class"],statics:{registerPreprocessor:function(b,d,a,c){if(Ext.getVersion("extjs")&&Ext.getVersion("core").isLessThan("4.1.0")){Ext.Class.registerPreprocessor(b,function(e,f,g){return d.call(this,e,f,f,g)}).setDefaultPreprocessorPosition(b,a,c)}else{Ext.Class.registerPreprocessor(b,function(f,g,e,h){return d.call(this,f,g,e,h)},[b],a,c)}},hookOnClassCreated:function(a,b){if(Ext.getVersion("extjs")&&Ext.getVersion("core").isLessThan("4.1.0")){Ext.Function.interceptBefore(a,"onClassCreated",b)}else{Ext.Function.interceptBefore(a,"onCreated",b)}},hookOnClassExtended:function(c,b){var a;if(Ext.getVersion("extjs")&&Ext.getVersion("core").isLessThan("4.1.0")){a=function(d,e){return b.call(this,d,e,e)}}else{a=b}if(c.onClassExtended!=null){Ext.Function.interceptBefore(c,"onClassExtended",a)}else{c.onClassExtended=a}},extendsClass:function(c,b){var a;try{if(Ext.getClassName(c)===b){return true}if(c!=null?c.superclass:void 0){if(Ext.getClassName(c.superclass)===b){return true}else{return Deft.Class.extendsClass(Ext.getClass(c.superclass),b)}}else{return false}}catch(d){a=d;return false}}}});Ext.define("Deft.mixin.Controllable",{onClassMixedIn:function(a){Deft.Logger.deprecate("Deft.mixin.Controllable has been deprecated and can now be omitted - simply use the 'controller' class annotation on its own.")}},function(){var a;if(Ext.getVersion("extjs")&&Ext.getVersion("core").isLessThan("4.1.0")){a=function(){return function(d){var b,c;if(d==null){d={}}if(this instanceof Ext.ClassManager.get("Ext.Component")&&!this.$controlled){try{b=Ext.create(this.controller,d.controllerConfig||this.controllerConfig||{})}catch(e){c=e;Deft.Logger.warn("Error initializing view controller: an error occurred while creating an instance of the specified controller: '"+this.controller+"'.");throw c}if(this.getController===void 0){this.getController=function(){return b}}this.$controlled=true;this.callOverridden(arguments);b.controlView(this);return this}return this.callOverridden(arguments)}}}else{a=function(){return function(d){var b,c;if(d==null){d={}}if(this instanceof Ext.ClassManager.get("Ext.Component")&&!this.$controlled){try{b=Ext.create(this.controller,d.controllerConfig||this.controllerConfig||{})}catch(e){c=e;Deft.Logger.warn("Error initializing view controller: an error occurred while creating an instance of the specified controller: '"+this.controller+"'.");throw c}if(this.getController===void 0){this.getController=function(){return b}}this.$controlled=true;this.callParent(arguments);b.controlView(this);return this}return this.callParent(arguments)}}}Deft.Class.registerPreprocessor("controller",function(d,e,b,f){var c;Deft.Class.hookOnClassCreated(b,function(g){g.override({constructor:a()})});Deft.Class.hookOnClassExtended(e,function(h,i,g){Deft.Class.hookOnClassCreated(g,function(j){j.override({constructor:a()})})});c=this;Ext.require([e.controller],function(){if(f!=null){f.call(c,d,e,b)}});return false},"before","extend")});Ext.define("Deft.mixin.Injectable",{onClassMixedIn:function(a){Deft.Logger.deprecate("Deft.mixin.Injectable has been deprecated and can now be omitted - simply use the 'inject' class annotation on its own.")}},function(){var a;if(Ext.getVersion("extjs")&&Ext.getVersion("core").isLessThan("4.1.0")){a=function(){return function(){if(!this.$injected){Deft.Injector.inject(this.inject,this,arguments,false);this.$injected=true}return this.callOverridden(arguments)}}}else{a=function(){return function(){if(!this.$injected){Deft.Injector.inject(this.inject,this,arguments,false);this.$injected=true}return this.callParent(arguments)}}}Deft.Class.registerPreprocessor("inject",function(b,e,j,i){var g,f,c,h,d;if(Ext.isString(e.inject)){e.inject=[e.inject]}if(Ext.isArray(e.inject)){g={};d=e.inject;for(c=0,h=d.length;c<h;c++){f=d[c];g[f]=f}e.inject=g}Deft.Class.hookOnClassCreated(j,function(k){k.override({constructor:a()})});Deft.Class.hookOnClassExtended(e,function(l,m,k){Deft.Class.hookOnClassCreated(k,function(n){n.override({constructor:a()})});if(m.inject==null){m.inject={}}Ext.applyIf(m.inject,l.superclass.inject)})},"before","extend")});Ext.define("Deft.mvc.Application",{alternateClassName:["Deft.Application"],initialized:false,constructor:function(a){if(a==null){a={}}this.initConfig(a);Ext.onReady(function(){this.init();this.initialized=true},this);return this},init:function(){}});Ext.define("Deft.mvc.ComponentSelectorListener",{constructor:function(c){var b,e,a,d;Ext.apply(this,c);if(this.componentSelector.live){Deft.LiveEventBus.addListener(this.componentSelector.view,this.componentSelector.selector,this.eventName,this.fn,this.scope,this.options)}else{d=this.componentSelector.components;for(e=0,a=d.length;e<a;e++){b=d[e];b.on(this.eventName,this.fn,this.scope,this.options)}}return this},destroy:function(){var b,d,a,c;if(this.componentSelector.live){Deft.LiveEventBus.removeListener(this.componentSelector.view,this.componentSelector.selector,this.eventName,this.fn,this.scope)}else{c=this.componentSelector.components;for(d=0,a=c.length;d<a;d++){b=c[d];b.un(this.eventName,this.fn,this.scope)}}}});Ext.define("Deft.mvc.ComponentSelector",{constructor:function(c){var a,e,g,b,d,f;Ext.apply(this,c);if(!this.live){this.components=this.selector!=null?Ext.ComponentQuery.query(this.selector,this.view):[this.view]}this.selectorListeners=[];if(Ext.isObject(this.listeners)){f=this.listeners;for(a in f){g=f[a];e=g;d=this.scope;b=null;if(Ext.isObject(g)){b=Ext.apply({},g);if(b.fn!=null){e=b.fn;delete b.fn}if(b.scope!=null){d=b.scope;delete b.scope}}if(Ext.isString(e)&&Ext.isFunction(d[e])){e=d[e]}if(!Ext.isFunction(e)){Ext.Error.raise({msg:"Error adding '"+a+"' listener: the specified handler '"+e+"' is not a Function or does not exist."})}this.addListener(a,e,d,b)}}return this},destroy:function(){var d,c,a,b;b=this.selectorListeners;for(c=0,a=b.length;c<a;c++){d=b[c];d.destroy()}this.selectorListeners=[]},addListener:function(a,d,c,b){var e;if(this.findListener(a,d,c)!=null){Ext.Error.raise({msg:"Error adding '"+a+"' listener: an existing listener for the specified function was already registered for '"+this.selector+"."})}Deft.Logger.log("Adding '"+a+"' listener to '"+this.selector+"'.");e=Ext.create("Deft.mvc.ComponentSelectorListener",{componentSelector:this,eventName:a,fn:d,scope:c,options:b});this.selectorListeners.push(e)},removeListener:function(a,c,b){var d;d=this.findListener(a,c,b);if(d!=null){Deft.Logger.log("Removing '"+a+"' listener from '"+this.selector+"'.");d.destroy();Ext.Array.remove(this.selectorListeners,d)}},findListener:function(b,d,c){var g,f,a,e;e=this.selectorListeners;for(f=0,a=e.length;f<a;f++){g=e[f];if(g.eventName===b&&g.fn===d&&g.scope===c){return g}}return null}});Ext.define("Deft.util.Function",{alternateClassName:["Deft.Function"],statics:{memoize:function(d,c,a){var b;b={};return function(f){var e;e=Ext.isFunction(a)?a.apply(c,arguments):f;if(!(e in b)){b[e]=d.apply(c,arguments)}return b[e]}},nextTick:function(b,a){if(a!=null){b=Ext.Function.bind(b,a)}setTimeout(b,0)},spread:function(b,a){return function(c){if(!Ext.isArray(c)){Ext.Error.raise({msg:"Error spreading passed Array over target function arguments: passed a non-Array."})}return b.apply(a,c)}}}},function(){if(typeof setImmediate!=="undefined"&&setImmediate!==null){return this.nextTick=function(b,a){if(a!=null){b=Ext.Function.bind(b,a)}setImmediate(b)}}});Ext.define("Deft.mvc.Observer",{statics:{mergeObserve:function(b,l){var d,q,m,r,g,k,o,i,n,p,e,f,a,j,h,c;if(!Ext.isObject(b)){a={}}else{a=Ext.clone(b)}if(!Ext.isObject(l)){g={}}else{g=Ext.clone(l)}i=["buffer","single","delay","element","target","destroyable"];o=function(A){var D,z,u,C,t,v,y,x,B,s,w;w=[];for(C in A){u=A[C];if(Ext.isArray(u)){z={};for(y=0,B=u.length;y<B;y++){v=u[y];if(Ext.Object.getSize(v)===1){Ext.apply(z,v)}else{D={};if((v!=null?v.fn:void 0)!=null){D.fn=v.fn}if((v!=null?v.scope:void 0)!=null){D.scope=v.scope}for(x=0,s=i.length;x<s;x++){t=i[x];if((v!=null?v[t]:void 0)!=null){D[t]=v[t]}}z[v.event]=[D]}}w.push(A[C]=z)}else{w.push(void 0)}}return w};o(a);o(g);for(k in g){q=g[k];for(d in q){m=q[d];if(Ext.isString(m)){g[k][d]=m.replace(" ","").split(",")}if(!(a!=null?a[k]:void 0)){a[k]={}}if(!(a!=null?(h=a[k])!=null?h[d]:void 0:void 0)){a[k][d]=g[k][d];delete g[k][d]}}}for(j in a){p=a[j];for(n in p){e=p[n];if(Ext.isString(e)){a[j][n]=e.split(",")}if(g!=null?(c=g[j])!=null?c[n]:void 0:void 0){r=g[j][n];f=a[j][n];a[j][n]=Ext.Array.unique(Ext.Array.insert(f,0,r))}}}return a}},constructor:function(a){var c,k,j,f,i,l,g,h,d,b,e;this.listeners=[];i=a!=null?a.host:void 0;d=a!=null?a.target:void 0;k=a!=null?a.events:void 0;if(i&&d&&(this.isPropertyChain(d)||this.isTargetObservable(i,d))){for(c in k){f=k[c];if(Ext.isString(f)){f=f.replace(" ","").split(",")}for(b=0,e=f.length;b<e;b++){j=f[b];h=i;l=null;if(Ext.isObject(j)){l=Ext.clone(j);if(l!=null?l.event:void 0){c=this.extract(l,"event")}if(l!=null?l.fn:void 0){j=this.extract(l,"fn")}if(l!=null?l.scope:void 0){h=this.extract(l,"scope")}}g=this.locateReferences(i,d,j);if(g){g.target.on(c,g.handler,h,l);this.listeners.push({targetName:d,target:g.target,event:c,handler:g.handler,scope:h});Deft.Logger.log("Created observer on '"+d+"' for event '"+c+"'.")}else{Deft.Logger.warn("Could not create observer on '"+d+"' for event '"+c+"'.")}}}}else{Deft.Logger.warn("Could not create observers on '"+d+"' because '"+d+"' is not an Ext.util.Observable")}return this},isTargetObservable:function(b,e){var a,d,c;a=this.locateTarget(b,e);if(a==null){return false}if((a.isObservable!=null)||(((c=a.mixins)!=null?c.observable:void 0)!=null)){return true}else{d=Ext.ClassManager.getClass(a);return Deft.Class.extendsClass(d,"Ext.util.Observable")||Deft.Class.extendsClass(d,"Ext.mixin.Observable")}},locateTarget:function(b,c){var a;if(Ext.isFunction(b["get"+Ext.String.capitalize(c)])){a=b["get"+Ext.String.capitalize(c)].call(b);return a}else{if((b!=null?b[c]:void 0)!=null){a=b[c];return a}else{return null}}},isPropertyChain:function(a){return Ext.isString(a)&&a.indexOf(".")>-1},locateReferences:function(c,d,a){var b,e;b=c;if(this.isPropertyChain(d)){e=this.parsePropertyChain(c,d);if(!e){return null}c=e.host;d=e.target}if(Ext.isFunction(a)){return{target:this.locateTarget(c,d),handler:a}}else{if(Ext.isFunction(b[a])){return{target:this.locateTarget(c,d),handler:b[a]}}else{return null}}},parsePropertyChain:function(a,b){var c;if(Ext.isString(b)){c=b.split(".")}else{if(Ext.isArray(b)){c=b}else{return null}}if(c.length>1&&(this.locateTarget(a,c[0])!=null)){return this.parsePropertyChain(this.locateTarget(a,c[0]),c.slice(1))}else{if(this.isTargetObservable(a,c[0])){return{host:a,target:c[0]}}else{return null}}},extract:function(a,b){var c;c=a[b];delete a[b];return c},destroy:function(){var d,c,a,b;b=this.listeners;for(c=0,a=b.length;c<a;c++){d=b[c];Deft.Logger.log("Removing observer on '"+d.targetName+"' for event '"+d.event+"'.");d.target.un(d.event,d.handler,d.scope)}this.listeners=[]}});Ext.define("Deft.mvc.ViewController",{alternateClassName:["Deft.ViewController"],config:{view:null},observe:{},constructor:function(a){if(a==null){a={}}if(a.view){this.controlView(a.view)}this.initConfig(a);if(Ext.Object.getSize(this.observe)>0){this.createObservers()}return this},controlView:function(a){if(a instanceof Ext.ClassManager.get("Ext.Component")){this.setView(a);this.registeredComponentReferences={};this.registeredComponentSelectors={};if(Ext.getVersion("extjs")!=null){if(this.getView().rendered){this.onViewInitialize()}else{this.getView().on("afterrender",this.onViewInitialize,this,{single:true})}}else{if(this.getView().initialized){this.onViewInitialize()}else{this.getView().on("initialize",this.onViewInitialize,this,{single:true})}}}else{Ext.Error.raise({msg:"Error constructing ViewController: the configured 'view' is not an Ext.Component."})}},init:function(){},destroy:function(){var b,a;for(b in this.registeredComponentReferences){this.removeComponentReference(b)}for(a in this.registeredComponentSelectors){this.removeComponentSelector(a)}this.removeObservers();return true},onViewInitialize:function(){var d,h,e,f,c,a,b,g;if(Ext.getVersion("extjs")!=null){this.getView().on("beforedestroy",this.onViewBeforeDestroy,this)}else{b=this;c=this.getView().destroy;this.getView().destroy=function(){if(b.destroy()){c.call(this)}}}g=this.control;for(h in g){d=g[h];a=null;if(h!=="view"){if(Ext.isString(d)){a=d}else{if(d.selector!=null){a=d.selector}else{a="#"+h}}}e=null;if(Ext.isObject(d.listeners)){e=d.listeners}else{if(!((d.selector!=null)||(d.live!=null))){e=d}}f=(d.live!=null)&&d.live;this.addComponentReference(h,a,f);this.addComponentSelector(a,e,f)}this.init()},onViewBeforeDestroy:function(){if(this.destroy()){this.getView().un("beforedestroy",this.onViewBeforeDestroy,this);return true}return false},addComponentReference:function(e,a,c){var b,d;if(c==null){c=false}Deft.Logger.log("Adding '"+e+"' component reference for selector: '"+a+"'.");if(this.registeredComponentReferences[e]!=null){Ext.Error.raise({msg:"Error adding component reference: an existing component reference was already registered as '"+e+"'."})}if(e!=="view"){b="get"+Ext.String.capitalize(e);if(this[b]==null){if(c){this[b]=Ext.Function.pass(this.getViewComponent,[a],this)}else{d=this.getViewComponent(a);if(d==null){Ext.Error.raise({msg:"Error locating component: no component(s) found matching '"+a+"'."})}this[b]=function(){return d}}this[b].generated=true}}this.registeredComponentReferences[e]=true},removeComponentReference:function(b){var a;Deft.Logger.log("Removing '"+b+"' component reference.");if(this.registeredComponentReferences[b]==null){Ext.Error.raise({msg:"Error removing component reference: no component reference is registered as '"+b+"'."})}if(b!=="view"){a="get"+Ext.String.capitalize(b);if(this[a].generated){this[a]=null}}delete this.registeredComponentReferences[b]},getViewComponent:function(a){var b;if(a!=null){b=Ext.ComponentQuery.query(a,this.getView());if(b.length===0){return null}else{if(b.length===1){return b[0]}else{return b}}}else{return this.getView()}},addComponentSelector:function(a,b,c){var d,e;if(c==null){c=false}Deft.Logger.log("Adding component selector for: '"+a+"'.");e=this.getComponentSelector(a);if(e!=null){Ext.Error.raise({msg:"Error adding component selector: an existing component selector was already registered for '"+a+"'."})}d=Ext.create("Deft.mvc.ComponentSelector",{view:this.getView(),selector:a,listeners:b,scope:this,live:c});this.registeredComponentSelectors[a]=d},removeComponentSelector:function(a){var b;Deft.Logger.log("Removing component selector for '"+a+"'.");b=this.getComponentSelector(a);if(b==null){Ext.Error.raise({msg:"Error removing component selector: no component selector registered for '"+a+"'."})}b.destroy();delete this.registeredComponentSelectors[a]},getComponentSelector:function(a){return this.registeredComponentSelectors[a]},createObservers:function(){var a,c,b;this.registeredObservers={};b=this.observe;for(c in b){a=b[c];this.addObserver(c,a)}},addObserver:function(c,b){var a;a=Ext.create("Deft.mvc.Observer",{host:this,target:c,events:b});return this.registeredObservers[c]=a},removeObservers:function(){var a,c,b;b=this.registeredObservers;for(c in b){a=b[c];a.destroy();delete this.registeredObservers[c]}}},function(){return Deft.Class.registerPreprocessor("observe",function(b,c,a,d){Deft.Class.hookOnClassExtended(c,function(f,h,e){var g;if(f.superclass&&((g=f.superclass)!=null?g.observe:void 0)&&Deft.Class.extendsClass(f,"Deft.mvc.ViewController")){h.observe=Deft.mvc.Observer.mergeObserve(f.superclass.observe,h.observe)}})},"before","extend")});Ext.define("Deft.promise.Resolver",{alternateClassName:["Deft.Resolver"],constructor:function(o,a,m){var c,k,j,e,n,l,h,i,b,d,g,f;this.promise=Ext.create("Deft.promise.Promise",this);i=[];d=false;e=false;n=null;l=null;if(!Ext.isFunction(a)){a=function(p){throw p}}h=Deft.util.Function.nextTick;g=function(){var q,r,p;for(r=0,p=i.length;r<p;r++){q=i[r];q[n](l)}i=[]};f=function(p){i.push(p);if(e){g()}};c=function(q,p){o=a=m=null;n=q;l=p;e=true;g()};j=function(p){c("resolve",p)};k=function(p){c("reject",p)};b=function(s,q){var p;d=true;try{if(Ext.isFunction(s)){q=s(q)}if(q&&Ext.isFunction(q.then)){q.then(j,k)}else{j(q)}}catch(r){p=r;k(p)}};this.resolve=function(p){if(!d){b(o,p)}};this.reject=function(p){if(!d){b(a,p)}};this.update=function(q){var r,s,p;if(!e){if(Ext.isFunction(m)){q=m(q)}for(s=0,p=i.length;s<p;s++){r=i[s];r.update(q)}}};this.then=function(s,p,r){var q;if(Ext.isFunction(s)||Ext.isFunction(p)||Ext.isFunction(r)){q=Ext.create("Deft.promise.Resolver",s,p,r);h(function(){return f(q)});return q.promise}return this.promise};return this},resolve:Ext.emptyFn,reject:Ext.emptyFn,update:Ext.emptyFn,then:Ext.emptyFn});Ext.define("Deft.promise.Promise",{alternateClassName:["Deft.Promise"],statics:{when:function(a){var b;b=Ext.create("Deft.promise.Deferred");b.resolve(a);return b.promise},isPromise:function(a){return(a&&Ext.isFunction(a.then))===true},all:function(a){if(!(Ext.isArray(a)||Deft.Promise.isPromise(a))){throw new Error("Invalid parameter: expected an Array or Promise of an Array.")}return Deft.Promise.map(a,function(b){return b})},any:function(a){if(!(Ext.isArray(a)||Deft.Promise.isPromise(a))){throw new Error("Invalid parameter: expected an Array or Promise of an Array.")}return Deft.Promise.some(a,1).then(function(b){return b[0]},function(b){if(b.message==="Too few Promises were resolved."){throw new Error("No Promises were resolved.")}else{throw b}})},some:function(b,a){if(!(Ext.isArray(b)||Deft.Promise.isPromise(b))){throw new Error("Invalid parameter: expected an Array or Promise of an Array.")}if(!Ext.isNumeric(a)||a<=0){throw new Error("Invalid parameter: expected a positive integer.")}return Deft.Promise.when(b).then(function(i){var d,p,k,n,o,e,g,c,j,f,m,h,l;m=[];j=a;c=(i.length-j)+1;p=Ext.create("Deft.promise.Deferred");if(i.length<a){p.reject(new Error("Too few Promises were resolved."))}else{f=function(q){m.push(q);j--;if(j===0){d();p.resolve(m)}return q};g=function(q){c--;if(c===0){d();p.reject(new Error("Too few Promises were resolved."))}return q};d=function(){return f=g=Ext.emptyFn};o=function(q){return f(q)};n=function(q){return g(q)};for(k=h=0,l=i.length;h<l;k=++h){e=i[k];if(k in i){Deft.Promise.when(e).then(o,n)}}}return p.promise})},delay:function(a,c){var b;if(arguments.length===1){c=a;a=void 0}c=Math.max(c,0);b=Ext.create("Deft.promise.Deferred");setTimeout(function(){b.resolve(a)},c);return b.promise},timeout:function(b,d){var a,c,e;c=Ext.create("Deft.promise.Deferred");e=setTimeout(function(){if(e){c.reject(new Error("Promise timed out."))}},d);a=function(){clearTimeout(e);return e=null};Deft.Promise.when(b).then(function(f){a();c.resolve(f)},function(f){a();c.reject(f)});return c.promise},memoize:function(d,c,a){var b;b=Deft.util.Function.memoize(d,c,a);return function(){return Deft.Promise.all(Ext.Array.toArray(arguments)).then(function(e){return b.apply(c,e)})}},map:function(a,b){if(!(Ext.isArray(a)||Deft.Promise.isPromise(a))){throw new Error("Invalid parameter: expected an Array or Promise of an Array.")}if(!Ext.isFunction(b)){throw new Error("Invalid parameter: expected a function.")}return Deft.Promise.when(a).then(function(d){var k,h,c,g,j,f,e,i;g=d.length;f=new Array(d.length);k=Ext.create("Deft.promise.Deferred");if(!g){k.resolve(f)}else{j=function(m,l){return Deft.Promise.when(m).then(function(n){return b(n,l,f)}).then(function(n){f[l]=n;if(!--g){k.resolve(f)}return n},k.reject)};for(h=e=0,i=d.length;e<i;h=++e){c=d[h];if(h in d){j(d[h],h)}else{g--}}}return k.promise})},reduce:function(b,c,a){var d;if(!(Ext.isArray(b)||Deft.Promise.isPromise(b))){throw new Error("Invalid parameter: expected an Array or Promise of an Array.")}if(!Ext.isFunction(c)){throw new Error("Invalid parameter: expected a function.")}d=arguments.length===3;return Deft.Promise.when(b).then(function(f){var e;e=[function(h,i,g){return Deft.Promise.when(h).then(function(j){return Deft.Promise.when(i).then(function(k){return c(j,k,g,f)})})}];if(d){e.push(a)}return Deft.Promise.reduceArray.apply(f,e)})},reduceArray:function(f,a){var d,g,c,e,b;c=0;g=Object(this);e=g.length>>>0;d=arguments;if(d.length<=1){while(true){if(c in g){b=g[c++];break}if(++c>=e){throw new TypeError("Reduce of empty array with no initial value")}}}else{b=d[1]}while(c<e){if(c in g){b=f(b,g[c],c,g)}c++}return b}},constructor:function(b){var a;a=function(c){Deft.util.Function.nextTick(function(){throw c})};this.then=function(g,c,f,d){var e;if(arguments.length===1&&Ext.isObject(arguments[0])){e=arguments[0],g=e.success,c=e.failure,f=e.progress,d=e.scope}if(d!=null){if(Ext.isFunction(g)){g=Ext.Function.bind(g,d)}if(Ext.isFunction(c)){c=Ext.Function.bind(c,d)}if(Ext.isFunction(f)){f=Ext.Function.bind(f,d)}}return b.then(g,c,f)};this.otherwise=function(c,d){var e;if(arguments.length===1&&Ext.isObject(arguments[0])){e=arguments[0],c=e.fn,d=e.scope}if(d!=null){c=Ext.Function.bind(c,d)}return b.then(null,c)};this.always=function(c,d){var e;if(arguments.length===1&&Ext.isObject(arguments[0])){e=arguments[0],c=e.fn,d=e.scope}if(d!=null){c=Ext.Function.bind(c,d)}return b.then(function(g){var f;try{c()}catch(h){f=h;a(f)}return g},function(g){var f;try{c()}catch(h){f=h;a(f)}throw g})};this.done=function(){b.then(null,a)};this.cancel=function(c){if(c==null){c=null}b.reject(new CancellationError(c))};this.log=function(c){if(c==null){c=""}return b.then(function(d){Deft.Logger.log(""+(c||"Promise")+" resolved with value: "+d);return d},function(d){Deft.Logger.log(""+(c||"Promise")+" rejected with reason: "+d);throw d})};return this},then:Ext.emptyFn,otherwise:Ext.emptyFn,always:Ext.emptyFn,done:Ext.emptyFn,cancel:Ext.emptyFn,log:Ext.emptyFn},function(){var a;if(Array.prototype.reduce!=null){this.reduceArray=Array.prototype.reduce}a=typeof exports!=="undefined"&&exports!==null?exports:window;a.CancellationError=function(b){if(Error.captureStackTrace){Error.captureStackTrace(this,CancellationError)}this.name="Canceled";this.message=b};a.CancellationError.prototype=new Error();a.CancellationError.constructor=a.CancellationError});Ext.define("Deft.promise.Chain",{alternateClassName:["Deft.Chain"],statics:{sequence:function(b,c){var a;if(c==null){c=null}a=[].slice.call(arguments,2);return Deft.Promise.reduce(b,function(d,e){if(!Ext.isFunction(e)){throw new Error("Invalid parameter: expected a function.")}return Deft.Promise.when(e.apply(c,a)).then(function(f){d.push(f);return d})},[])},parallel:function(b,c){var a;if(c==null){c=null}a=[].slice.call(arguments,2);return Deft.Promise.map(b,function(d){if(!Ext.isFunction(d)){throw new Error("Invalid parameter: expected a function.")}return d.apply(c,a)})},pipeline:function(b,a,c){if(c==null){c=null}return Deft.Promise.reduce(b,function(e,d){if(!Ext.isFunction(d)){throw new Error("Invalid parameter: expected a function.")}return d.call(c,e)},a)}}});Ext.define("Deft.promise.Deferred",{alternateClassName:["Deft.Deferred"],statics:{resolve:function(b){var a;a=Ext.create("Deft.promise.Deferred");a.resolve(b);return a.promise},reject:function(b){var a;a=Ext.create("Deft.promise.Deferred");a.reject(b);return a.promise}},promise:null,constructor:function(){var a;a=Ext.create("Deft.promise.Resolver");this.promise=a.promise;this.resolve=function(b){return a.resolve(b)};this.reject=function(b){return a.reject(b)};this.update=function(b){return a.update(b)};return this},resolve:Ext.emptyFn,reject:Ext.emptyFn,update:Ext.emptyFn,getPromise:function(){return this.promise}});
                //! moment.js
//! version : 2.5.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
(function(a){function b(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function c(a,b){return function(c){return k(a.call(this,c),b)}}function d(a,b){return function(c){return this.lang().ordinal(a.call(this,c),b)}}function e(){}function f(a){w(a),h(this,a)}function g(a){var b=q(a),c=b.year||0,d=b.month||0,e=b.week||0,f=b.day||0,g=b.hour||0,h=b.minute||0,i=b.second||0,j=b.millisecond||0;this._milliseconds=+j+1e3*i+6e4*h+36e5*g,this._days=+f+7*e,this._months=+d+12*c,this._data={},this._bubble()}function h(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return b.hasOwnProperty("toString")&&(a.toString=b.toString),b.hasOwnProperty("valueOf")&&(a.valueOf=b.valueOf),a}function i(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&qb.hasOwnProperty(b)&&(c[b]=a[b]);return c}function j(a){return 0>a?Math.ceil(a):Math.floor(a)}function k(a,b,c){for(var d=""+Math.abs(a),e=a>=0;d.length<b;)d="0"+d;return(e?c?"+":"":"-")+d}function l(a,b,c,d){var e,f,g=b._milliseconds,h=b._days,i=b._months;g&&a._d.setTime(+a._d+g*c),(h||i)&&(e=a.minute(),f=a.hour()),h&&a.date(a.date()+h*c),i&&a.month(a.month()+i*c),g&&!d&&db.updateOffset(a),(h||i)&&(a.minute(e),a.hour(f))}function m(a){return"[object Array]"===Object.prototype.toString.call(a)}function n(a){return"[object Date]"===Object.prototype.toString.call(a)||a instanceof Date}function o(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;e>d;d++)(c&&a[d]!==b[d]||!c&&s(a[d])!==s(b[d]))&&g++;return g+f}function p(a){if(a){var b=a.toLowerCase().replace(/(.)s$/,"$1");a=Tb[a]||Ub[b]||b}return a}function q(a){var b,c,d={};for(c in a)a.hasOwnProperty(c)&&(b=p(c),b&&(d[b]=a[c]));return d}function r(b){var c,d;if(0===b.indexOf("week"))c=7,d="day";else{if(0!==b.indexOf("month"))return;c=12,d="month"}db[b]=function(e,f){var g,h,i=db.fn._lang[b],j=[];if("number"==typeof e&&(f=e,e=a),h=function(a){var b=db().utc().set(d,a);return i.call(db.fn._lang,b,e||"")},null!=f)return h(f);for(g=0;c>g;g++)j.push(h(g));return j}}function s(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=b>=0?Math.floor(b):Math.ceil(b)),c}function t(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function u(a){return v(a)?366:365}function v(a){return a%4===0&&a%100!==0||a%400===0}function w(a){var b;a._a&&-2===a._pf.overflow&&(b=a._a[jb]<0||a._a[jb]>11?jb:a._a[kb]<1||a._a[kb]>t(a._a[ib],a._a[jb])?kb:a._a[lb]<0||a._a[lb]>23?lb:a._a[mb]<0||a._a[mb]>59?mb:a._a[nb]<0||a._a[nb]>59?nb:a._a[ob]<0||a._a[ob]>999?ob:-1,a._pf._overflowDayOfYear&&(ib>b||b>kb)&&(b=kb),a._pf.overflow=b)}function x(a){return null==a._isValid&&(a._isValid=!isNaN(a._d.getTime())&&a._pf.overflow<0&&!a._pf.empty&&!a._pf.invalidMonth&&!a._pf.nullInput&&!a._pf.invalidFormat&&!a._pf.userInvalidated,a._strict&&(a._isValid=a._isValid&&0===a._pf.charsLeftOver&&0===a._pf.unusedTokens.length)),a._isValid}function y(a){return a?a.toLowerCase().replace("_","-"):a}function z(a,b){return b._isUTC?db(a).zone(b._offset||0):db(a).local()}function A(a,b){return b.abbr=a,pb[a]||(pb[a]=new e),pb[a].set(b),pb[a]}function B(a){delete pb[a]}function C(a){var b,c,d,e,f=0,g=function(a){if(!pb[a]&&rb)try{require("./lang/"+a)}catch(b){}return pb[a]};if(!a)return db.fn._lang;if(!m(a)){if(c=g(a))return c;a=[a]}for(;f<a.length;){for(e=y(a[f]).split("-"),b=e.length,d=y(a[f+1]),d=d?d.split("-"):null;b>0;){if(c=g(e.slice(0,b).join("-")))return c;if(d&&d.length>=b&&o(e,d,!0)>=b-1)break;b--}f++}return db.fn._lang}function D(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function E(a){var b,c,d=a.match(vb);for(b=0,c=d.length;c>b;b++)d[b]=Yb[d[b]]?Yb[d[b]]:D(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function F(a,b){return a.isValid()?(b=G(b,a.lang()),Vb[b]||(Vb[b]=E(b)),Vb[b](a)):a.lang().invalidDate()}function G(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(wb.lastIndex=0;d>=0&&wb.test(a);)a=a.replace(wb,c),wb.lastIndex=0,d-=1;return a}function H(a,b){var c,d=b._strict;switch(a){case"DDDD":return Ib;case"YYYY":case"GGGG":case"gggg":return d?Jb:zb;case"Y":case"G":case"g":return Lb;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return d?Kb:Ab;case"S":if(d)return Gb;case"SS":if(d)return Hb;case"SSS":if(d)return Ib;case"DDD":return yb;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Cb;case"a":case"A":return C(b._l)._meridiemParse;case"X":return Fb;case"Z":case"ZZ":return Db;case"T":return Eb;case"SSSS":return Bb;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return d?Hb:xb;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return xb;default:return c=new RegExp(P(O(a.replace("\\","")),"i"))}}function I(a){a=a||"";var b=a.match(Db)||[],c=b[b.length-1]||[],d=(c+"").match(Qb)||["-",0,0],e=+(60*d[1])+s(d[2]);return"+"===d[0]?-e:e}function J(a,b,c){var d,e=c._a;switch(a){case"M":case"MM":null!=b&&(e[jb]=s(b)-1);break;case"MMM":case"MMMM":d=C(c._l).monthsParse(b),null!=d?e[jb]=d:c._pf.invalidMonth=b;break;case"D":case"DD":null!=b&&(e[kb]=s(b));break;case"DDD":case"DDDD":null!=b&&(c._dayOfYear=s(b));break;case"YY":e[ib]=s(b)+(s(b)>68?1900:2e3);break;case"YYYY":case"YYYYY":case"YYYYYY":e[ib]=s(b);break;case"a":case"A":c._isPm=C(c._l).isPM(b);break;case"H":case"HH":case"h":case"hh":e[lb]=s(b);break;case"m":case"mm":e[mb]=s(b);break;case"s":case"ss":e[nb]=s(b);break;case"S":case"SS":case"SSS":case"SSSS":e[ob]=s(1e3*("0."+b));break;case"X":c._d=new Date(1e3*parseFloat(b));break;case"Z":case"ZZ":c._useUTC=!0,c._tzm=I(b);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":a=a.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":a=a.substr(0,2),b&&(c._w=c._w||{},c._w[a]=b)}}function K(a){var b,c,d,e,f,g,h,i,j,k,l=[];if(!a._d){for(d=M(a),a._w&&null==a._a[kb]&&null==a._a[jb]&&(f=function(b){var c=parseInt(b,10);return b?b.length<3?c>68?1900+c:2e3+c:c:null==a._a[ib]?db().weekYear():a._a[ib]},g=a._w,null!=g.GG||null!=g.W||null!=g.E?h=Z(f(g.GG),g.W||1,g.E,4,1):(i=C(a._l),j=null!=g.d?V(g.d,i):null!=g.e?parseInt(g.e,10)+i._week.dow:0,k=parseInt(g.w,10)||1,null!=g.d&&j<i._week.dow&&k++,h=Z(f(g.gg),k,j,i._week.doy,i._week.dow)),a._a[ib]=h.year,a._dayOfYear=h.dayOfYear),a._dayOfYear&&(e=null==a._a[ib]?d[ib]:a._a[ib],a._dayOfYear>u(e)&&(a._pf._overflowDayOfYear=!0),c=U(e,0,a._dayOfYear),a._a[jb]=c.getUTCMonth(),a._a[kb]=c.getUTCDate()),b=0;3>b&&null==a._a[b];++b)a._a[b]=l[b]=d[b];for(;7>b;b++)a._a[b]=l[b]=null==a._a[b]?2===b?1:0:a._a[b];l[lb]+=s((a._tzm||0)/60),l[mb]+=s((a._tzm||0)%60),a._d=(a._useUTC?U:T).apply(null,l)}}function L(a){var b;a._d||(b=q(a._i),a._a=[b.year,b.month,b.day,b.hour,b.minute,b.second,b.millisecond],K(a))}function M(a){var b=new Date;return a._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()]}function N(a){a._a=[],a._pf.empty=!0;var b,c,d,e,f,g=C(a._l),h=""+a._i,i=h.length,j=0;for(d=G(a._f,g).match(vb)||[],b=0;b<d.length;b++)e=d[b],c=(h.match(H(e,a))||[])[0],c&&(f=h.substr(0,h.indexOf(c)),f.length>0&&a._pf.unusedInput.push(f),h=h.slice(h.indexOf(c)+c.length),j+=c.length),Yb[e]?(c?a._pf.empty=!1:a._pf.unusedTokens.push(e),J(e,c,a)):a._strict&&!c&&a._pf.unusedTokens.push(e);a._pf.charsLeftOver=i-j,h.length>0&&a._pf.unusedInput.push(h),a._isPm&&a._a[lb]<12&&(a._a[lb]+=12),a._isPm===!1&&12===a._a[lb]&&(a._a[lb]=0),K(a),w(a)}function O(a){return a.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e})}function P(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Q(a){var c,d,e,f,g;if(0===a._f.length)return a._pf.invalidFormat=!0,a._d=new Date(0/0),void 0;for(f=0;f<a._f.length;f++)g=0,c=h({},a),c._pf=b(),c._f=a._f[f],N(c),x(c)&&(g+=c._pf.charsLeftOver,g+=10*c._pf.unusedTokens.length,c._pf.score=g,(null==e||e>g)&&(e=g,d=c));h(a,d||c)}function R(a){var b,c,d=a._i,e=Mb.exec(d);if(e){for(a._pf.iso=!0,b=0,c=Ob.length;c>b;b++)if(Ob[b][1].exec(d)){a._f=Ob[b][0]+(e[6]||" ");break}for(b=0,c=Pb.length;c>b;b++)if(Pb[b][1].exec(d)){a._f+=Pb[b][0];break}d.match(Db)&&(a._f+="Z"),N(a)}else a._d=new Date(d)}function S(b){var c=b._i,d=sb.exec(c);c===a?b._d=new Date:d?b._d=new Date(+d[1]):"string"==typeof c?R(b):m(c)?(b._a=c.slice(0),K(b)):n(c)?b._d=new Date(+c):"object"==typeof c?L(b):b._d=new Date(c)}function T(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return 1970>a&&h.setFullYear(a),h}function U(a){var b=new Date(Date.UTC.apply(null,arguments));return 1970>a&&b.setUTCFullYear(a),b}function V(a,b){if("string"==typeof a)if(isNaN(a)){if(a=b.weekdaysParse(a),"number"!=typeof a)return null}else a=parseInt(a,10);return a}function W(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function X(a,b,c){var d=hb(Math.abs(a)/1e3),e=hb(d/60),f=hb(e/60),g=hb(f/24),h=hb(g/365),i=45>d&&["s",d]||1===e&&["m"]||45>e&&["mm",e]||1===f&&["h"]||22>f&&["hh",f]||1===g&&["d"]||25>=g&&["dd",g]||45>=g&&["M"]||345>g&&["MM",hb(g/30)]||1===h&&["y"]||["yy",h];return i[2]=b,i[3]=a>0,i[4]=c,W.apply({},i)}function Y(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),e-7>f&&(f+=7),d=db(a).add("d",f),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function Z(a,b,c,d,e){var f,g,h=U(a,0,1).getUTCDay();return c=null!=c?c:e,f=e-h+(h>d?7:0)-(e>h?7:0),g=7*(b-1)+(c-e)+f+1,{year:g>0?a:a-1,dayOfYear:g>0?g:u(a-1)+g}}function $(a){var b=a._i,c=a._f;return null===b?db.invalid({nullInput:!0}):("string"==typeof b&&(a._i=b=C().preparse(b)),db.isMoment(b)?(a=i(b),a._d=new Date(+b._d)):c?m(c)?Q(a):N(a):S(a),new f(a))}function _(a,b){db.fn[a]=db.fn[a+"s"]=function(a){var c=this._isUTC?"UTC":"";return null!=a?(this._d["set"+c+b](a),db.updateOffset(this),this):this._d["get"+c+b]()}}function ab(a){db.duration.fn[a]=function(){return this._data[a]}}function bb(a,b){db.duration.fn["as"+a]=function(){return+this/b}}function cb(a){var b=!1,c=db;"undefined"==typeof ender&&(a?(gb.moment=function(){return!b&&console&&console.warn&&(b=!0,console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),c.apply(null,arguments)},h(gb.moment,c)):gb.moment=db)}for(var db,eb,fb="2.5.1",gb=this,hb=Math.round,ib=0,jb=1,kb=2,lb=3,mb=4,nb=5,ob=6,pb={},qb={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_isUTC:null,_offset:null,_pf:null,_lang:null},rb="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require,sb=/^\/?Date\((\-?\d+)/i,tb=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,ub=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,vb=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,wb=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,xb=/\d\d?/,yb=/\d{1,3}/,zb=/\d{1,4}/,Ab=/[+\-]?\d{1,6}/,Bb=/\d+/,Cb=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Db=/Z|[\+\-]\d\d:?\d\d/gi,Eb=/T/i,Fb=/[\+\-]?\d+(\.\d{1,3})?/,Gb=/\d/,Hb=/\d\d/,Ib=/\d{3}/,Jb=/\d{4}/,Kb=/[+-]?\d{6}/,Lb=/[+-]?\d+/,Mb=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Nb="YYYY-MM-DDTHH:mm:ssZ",Ob=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],Pb=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Qb=/([\+\-]|\d\d)/gi,Rb="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),Sb={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},Tb={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},Ub={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},Vb={},Wb="DDD w W M D d".split(" "),Xb="M D H h m s w W".split(" "),Yb={M:function(){return this.month()+1},MMM:function(a){return this.lang().monthsShort(this,a)},MMMM:function(a){return this.lang().months(this,a)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(a){return this.lang().weekdaysMin(this,a)},ddd:function(a){return this.lang().weekdaysShort(this,a)},dddd:function(a){return this.lang().weekdays(this,a)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return k(this.year()%100,2)},YYYY:function(){return k(this.year(),4)},YYYYY:function(){return k(this.year(),5)},YYYYYY:function(){var a=this.year(),b=a>=0?"+":"-";return b+k(Math.abs(a),6)},gg:function(){return k(this.weekYear()%100,2)},gggg:function(){return k(this.weekYear(),4)},ggggg:function(){return k(this.weekYear(),5)},GG:function(){return k(this.isoWeekYear()%100,2)},GGGG:function(){return k(this.isoWeekYear(),4)},GGGGG:function(){return k(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return s(this.milliseconds()/100)},SS:function(){return k(s(this.milliseconds()/10),2)},SSS:function(){return k(this.milliseconds(),3)},SSSS:function(){return k(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+k(s(a/60),2)+":"+k(s(a)%60,2)},ZZ:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+k(s(a/60),2)+k(s(a)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},Zb=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];Wb.length;)eb=Wb.pop(),Yb[eb+"o"]=d(Yb[eb],eb);for(;Xb.length;)eb=Xb.pop(),Yb[eb+eb]=c(Yb[eb],2);for(Yb.DDDD=c(Yb.DDD,3),h(e.prototype,{set:function(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(a){return this._months[a.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(a){return this._monthsShort[a.month()]},monthsParse:function(a){var b,c,d;for(this._monthsParse||(this._monthsParse=[]),b=0;12>b;b++)if(this._monthsParse[b]||(c=db.utc([2e3,b]),d="^"+this.months(c,"")+"|^"+this.monthsShort(c,""),this._monthsParse[b]=new RegExp(d.replace(".",""),"i")),this._monthsParse[b].test(a))return b},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(a){return this._weekdays[a.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(a){return this._weekdaysShort[a.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(a){return this._weekdaysMin[a.day()]},weekdaysParse:function(a){var b,c,d;for(this._weekdaysParse||(this._weekdaysParse=[]),b=0;7>b;b++)if(this._weekdaysParse[b]||(c=db([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(a){var b=this._longDateFormat[a];return!b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a]=b),b},isPM:function(a){return"p"===(a+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(a,b){var c=this._calendar[a];return"function"==typeof c?c.apply(b):c},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)},pastFuture:function(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)},ordinal:function(a){return this._ordinal.replace("%d",a)},_ordinal:"%d",preparse:function(a){return a},postformat:function(a){return a},week:function(a){return Y(a,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),db=function(c,d,e,f){var g;return"boolean"==typeof e&&(f=e,e=a),g={},g._isAMomentObject=!0,g._i=c,g._f=d,g._l=e,g._strict=f,g._isUTC=!1,g._pf=b(),$(g)},db.utc=function(c,d,e,f){var g;return"boolean"==typeof e&&(f=e,e=a),g={},g._isAMomentObject=!0,g._useUTC=!0,g._isUTC=!0,g._l=e,g._i=c,g._f=d,g._strict=f,g._pf=b(),$(g).utc()},db.unix=function(a){return db(1e3*a)},db.duration=function(a,b){var c,d,e,f=a,h=null;return db.isDuration(a)?f={ms:a._milliseconds,d:a._days,M:a._months}:"number"==typeof a?(f={},b?f[b]=a:f.milliseconds=a):(h=tb.exec(a))?(c="-"===h[1]?-1:1,f={y:0,d:s(h[kb])*c,h:s(h[lb])*c,m:s(h[mb])*c,s:s(h[nb])*c,ms:s(h[ob])*c}):(h=ub.exec(a))&&(c="-"===h[1]?-1:1,e=function(a){var b=a&&parseFloat(a.replace(",","."));return(isNaN(b)?0:b)*c},f={y:e(h[2]),M:e(h[3]),d:e(h[4]),h:e(h[5]),m:e(h[6]),s:e(h[7]),w:e(h[8])}),d=new g(f),db.isDuration(a)&&a.hasOwnProperty("_lang")&&(d._lang=a._lang),d},db.version=fb,db.defaultFormat=Nb,db.updateOffset=function(){},db.lang=function(a,b){var c;return a?(b?A(y(a),b):null===b?(B(a),a="en"):pb[a]||C(a),c=db.duration.fn._lang=db.fn._lang=C(a),c._abbr):db.fn._lang._abbr},db.langData=function(a){return a&&a._lang&&a._lang._abbr&&(a=a._lang._abbr),C(a)},db.isMoment=function(a){return a instanceof f||null!=a&&a.hasOwnProperty("_isAMomentObject")},db.isDuration=function(a){return a instanceof g},eb=Zb.length-1;eb>=0;--eb)r(Zb[eb]);for(db.normalizeUnits=function(a){return p(a)},db.invalid=function(a){var b=db.utc(0/0);return null!=a?h(b._pf,a):b._pf.userInvalidated=!0,b},db.parseZone=function(a){return db(a).parseZone()},h(db.fn=f.prototype,{clone:function(){return db(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var a=db(this).utc();return 0<a.year()&&a.year()<=9999?F(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):F(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds()]},isValid:function(){return x(this)},isDSTShifted:function(){return this._a?this.isValid()&&o(this._a,(this._isUTC?db.utc(this._a):db(this._a)).toArray())>0:!1},parsingFlags:function(){return h({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(a){var b=F(this,a||db.defaultFormat);return this.lang().postformat(b)},add:function(a,b){var c;return c="string"==typeof a?db.duration(+b,a):db.duration(a,b),l(this,c,1),this},subtract:function(a,b){var c;return c="string"==typeof a?db.duration(+b,a):db.duration(a,b),l(this,c,-1),this},diff:function(a,b,c){var d,e,f=z(a,this),g=6e4*(this.zone()-f.zone());return b=p(b),"year"===b||"month"===b?(d=432e5*(this.daysInMonth()+f.daysInMonth()),e=12*(this.year()-f.year())+(this.month()-f.month()),e+=(this-db(this).startOf("month")-(f-db(f).startOf("month")))/d,e-=6e4*(this.zone()-db(this).startOf("month").zone()-(f.zone()-db(f).startOf("month").zone()))/d,"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:j(e)},from:function(a,b){return db.duration(this.diff(a)).lang(this.lang()._abbr).humanize(!b)},fromNow:function(a){return this.from(db(),a)},calendar:function(){var a=z(db(),this).startOf("day"),b=this.diff(a,"days",!0),c=-6>b?"sameElse":-1>b?"lastWeek":0>b?"lastDay":1>b?"sameDay":2>b?"nextDay":7>b?"nextWeek":"sameElse";return this.format(this.lang().calendar(c,this))},isLeapYear:function(){return v(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=V(a,this.lang()),this.add({d:a-b})):b},month:function(a){var b,c=this._isUTC?"UTC":"";return null!=a?"string"==typeof a&&(a=this.lang().monthsParse(a),"number"!=typeof a)?this:(b=this.date(),this.date(1),this._d["set"+c+"Month"](a),this.date(Math.min(b,this.daysInMonth())),db.updateOffset(this),this):this._d["get"+c+"Month"]()},startOf:function(a){switch(a=p(a)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a?this.weekday(0):"isoWeek"===a&&this.isoWeekday(1),this},endOf:function(a){return a=p(a),this.startOf(a).add("isoWeek"===a?"week":a,1).subtract("ms",1)},isAfter:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)>+db(a).startOf(b)},isBefore:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)<+db(a).startOf(b)},isSame:function(a,b){return b=b||"ms",+this.clone().startOf(b)===+z(a,this).startOf(b)},min:function(a){return a=db.apply(null,arguments),this>a?this:a},max:function(a){return a=db.apply(null,arguments),a>this?this:a},zone:function(a){var b=this._offset||0;return null==a?this._isUTC?b:this._d.getTimezoneOffset():("string"==typeof a&&(a=I(a)),Math.abs(a)<16&&(a=60*a),this._offset=a,this._isUTC=!0,b!==a&&l(this,db.duration(b-a,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(a){return a=a?db(a).zone():0,(this.zone()-a)%60===0},daysInMonth:function(){return t(this.year(),this.month())},dayOfYear:function(a){var b=hb((db(this).startOf("day")-db(this).startOf("year"))/864e5)+1;return null==a?b:this.add("d",a-b)},quarter:function(){return Math.ceil((this.month()+1)/3)},weekYear:function(a){var b=Y(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==a?b:this.add("y",a-b)},isoWeekYear:function(a){var b=Y(this,1,4).year;return null==a?b:this.add("y",a-b)},week:function(a){var b=this.lang().week(this);return null==a?b:this.add("d",7*(a-b))},isoWeek:function(a){var b=Y(this,1,4).week;return null==a?b:this.add("d",7*(a-b))},weekday:function(a){var b=(this.day()+7-this.lang()._week.dow)%7;return null==a?b:this.add("d",a-b)},isoWeekday:function(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)},get:function(a){return a=p(a),this[a]()},set:function(a,b){return a=p(a),"function"==typeof this[a]&&this[a](b),this},lang:function(b){return b===a?this._lang:(this._lang=C(b),this)}}),eb=0;eb<Rb.length;eb++)_(Rb[eb].toLowerCase().replace(/s$/,""),Rb[eb]);_("year","FullYear"),db.fn.days=db.fn.day,db.fn.months=db.fn.month,db.fn.weeks=db.fn.week,db.fn.isoWeeks=db.fn.isoWeek,db.fn.toJSON=db.fn.toISOString,h(db.duration.fn=g.prototype,{_bubble:function(){var a,b,c,d,e=this._milliseconds,f=this._days,g=this._months,h=this._data;h.milliseconds=e%1e3,a=j(e/1e3),h.seconds=a%60,b=j(a/60),h.minutes=b%60,c=j(b/60),h.hours=c%24,f+=j(c/24),h.days=f%30,g+=j(f/30),h.months=g%12,d=j(g/12),h.years=d},weeks:function(){return j(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*s(this._months/12)},humanize:function(a){var b=+this,c=X(b,!a,this.lang());return a&&(c=this.lang().pastFuture(b,c)),this.lang().postformat(c)},add:function(a,b){var c=db.duration(a,b);return this._milliseconds+=c._milliseconds,this._days+=c._days,this._months+=c._months,this._bubble(),this},subtract:function(a,b){var c=db.duration(a,b);return this._milliseconds-=c._milliseconds,this._days-=c._days,this._months-=c._months,this._bubble(),this},get:function(a){return a=p(a),this[a.toLowerCase()+"s"]()},as:function(a){return a=p(a),this["as"+a.charAt(0).toUpperCase()+a.slice(1)+"s"]()},lang:db.fn.lang,toIsoString:function(){var a=Math.abs(this.years()),b=Math.abs(this.months()),c=Math.abs(this.days()),d=Math.abs(this.hours()),e=Math.abs(this.minutes()),f=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(a?a+"Y":"")+(b?b+"M":"")+(c?c+"D":"")+(d||e||f?"T":"")+(d?d+"H":"")+(e?e+"M":"")+(f?f+"S":""):"P0D"}});for(eb in Sb)Sb.hasOwnProperty(eb)&&(bb(eb,Sb[eb]),ab(eb.toLowerCase()));bb("Weeks",6048e5),db.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},db.lang("en",{ordinal:function(a){var b=a%10,c=1===s(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),rb?(module.exports=db,cb(!0)):"function"==typeof define&&define.amd?define("moment",function(b,c,d){return d.config&&d.config()&&d.config().noGlobal!==!0&&cb(d.config().noGlobal===a),db}):cb()}).call(this);
                Ext.define('CustomApp', {
    extend: 'Rally.app.App',
    componentCls: 'app',
    items: [
        {xtype: 'appPanel'}
    ],
    launch: function() {
    }
});

                Ext.define('rlm.data.BuildData', {

    buildStore: null,

    constructor: function() {
        this.buildStore = Ext.create('Rally.data.WsapiDataStore', {
            model: 'Build',
            fetch: true,
            autoLoad: false,
            context: {
                project: null
            },
            limit: Infinity
        });
        this.callParent(arguments);
    },

    query: function(options) {
        var filters = [],
            deferred = new Deft.Deferred();

        if (options.build) {
            filters.push(Ext.create('Rally.data.wsapi.Filter', {
                property: 'BuildDefinition',
                operator: '=',
                value: options.build
            }));
        } else {
            return deferred.reject('No Build chosen.');
        }

        if (options.fromDate) {
            filters.push(Ext.create('Rally.data.wsapi.Filter', {
                property: 'Start',
                operator: '>=',
                value: this._getFormattedDate(options.fromDate)
            }));
        }

        if (options.toDate) {
            filters.push(Ext.create('Rally.data.wsapi.Filter', {
                property: 'Start',
                operator: '<=',
                value: this._getFormattedDate(options.toDate)
            }));
        }

        this.buildStore.load({
            filters: filters,
            callback: function(records, operation, success) {
                if (success) {
                    deferred.resolve(records);
                } else {
                    deferred.reject('Store did not successfully load.');
                }
            }
        });

        return deferred.promise;
    },

    _getFormattedDate: function(date) {
        return moment(date).format('YYYY-MM-DD');
    }

});
                Ext.define('rlm.controller.ResultsController', {
    
    START_HOUR: 6,
    END_HOUR: 18,

    updateResults: function(builds, resultsDisplay) {
        var results = this._calculate(builds);
        resultsDisplay.update(results);
    },
    
    _calculate: function(builds) {
        var previousBuild,
            previousBuildState,
            currentBuildState,
            diffDuringWorkHours,
            previousDate,
            workingDayCount = 0,
            analyzedBuildCount = 0,
            buildTime = 0,
            buildTimeCount = 0,
            greenTime = 0,
            redTime = 0;

        Ext.Array.each(builds, function(currentBuild) {
            if (!this._shouldAnalyzeBuild(currentBuild)) {
                return;
            }
            analyzedBuildCount++;

            if (currentBuild.get('Status') !== "UNKNOWN") {
                buildTimeCount++;
                buildTime += this._getBuildTimeMillis(currentBuild);
            }

            diffDuringWorkHours = this._getTimeDiffDuringWorkHours(currentBuild, previousBuild);
            previousBuildState = previousBuild ? this._getStatus(previousBuild) : null;
            currentBuildState = this._getStatus(currentBuild);

            var currentEndDate = new Date(this._getEndDateMillis(currentBuild)),
                previousEndDate = new Date(this._getEndDateMillis(previousBuild)),
                currentDate = new Date(this._getStartTime(currentBuild)).getDate();

            if (!this._isSameDay(currentEndDate, previousEndDate) &&
                    this._isDateAWorkingDay(currentEndDate)) {
                workingDayCount++;
            }

            if (currentBuildState !== previousBuildState) {
                if (currentBuildState === 'SUCCESS') {
                    redTime += diffDuringWorkHours;
                } else if (previousBuildState === 'SUCCESS') { //don't count non-green colors
                    greenTime += diffDuringWorkHours;
                } else {
                }
            } else if (currentBuildState === 'SUCCESS') {
                greenTime += diffDuringWorkHours;
            }
            else {
                redTime += diffDuringWorkHours;
            }

            previousBuild = currentBuild;
            previousDate = currentDate;
            }, this
        );

        var totalTime = greenTime + redTime;

        return {
            countingToday: new Date().getHours() < this.END_HOUR,
            avgBuildTime: this._showHoursMinutesSeconds(buildTime/buildTimeCount),
            avgGreenLightTime: this._showHoursMinutesSeconds(greenTime/workingDayCount),
            avgGreenLightPercent: Number(greenTime/totalTime * 100).toFixed(2) + "%",
            avgRedLightTime: this._showHoursMinutesSeconds(redTime/workingDayCount),
            avgRedLightPercent: Number(redTime/totalTime * 100).toFixed(2) + "%",
            numberOfBuilds: analyzedBuildCount,
            numberOfWorkingDays: workingDayCount,
            totalGreenLightTime: this._showHoursMinutesSeconds(greenTime),
            totalRedLightTime: this._showHoursMinutesSeconds(redTime)
        };
    },


    _getTimeDiffDuringWorkHours: function(currentBuild, previousBuild) {
        var currentBuildEndDateMillis = this._getEndDateMillis(currentBuild),
            previousBuildEndDateMillis;

        //first build, we can't determine so throw it out
        if (!previousBuild) {
            return 0;
        }

        previousBuildEndDateMillis = this._getEndDateMillis(previousBuild);

        //working hours
        if (this._isSpanDuringWorkingHours(currentBuildEndDateMillis, previousBuildEndDateMillis)) {
            return currentBuildEndDateMillis - previousBuildEndDateMillis;
        }

        //span straddles working hours
        if (!this._isSameDay(currentBuildEndDateMillis, previousBuildEndDateMillis)) {
            return this._handleMultiDaySpan(currentBuild, previousBuild);
        }
        if (!this._isTimeWithinWorkingHours(previousBuildEndDateMillis) && this._isTimeWithinWorkingHours(currentBuildEndDateMillis)) {
            return currentBuildEndDateMillis  - this._getWorkingDayStartInMillis(currentBuild);
        } else if (this._isTimeWithinWorkingHours(previousBuildEndDateMillis) && !this._isTimeWithinWorkingHours(currentBuildEndDateMillis)) {
            return this._getWorkingDayEndInMillis(currentBuild) - previousBuildEndDateMillis;
        } else {
            return 0;  //outside working hours
        }
    },

    _handleMultiDaySpan: function(currentBuild, previousBuild) {
        var total = 0,
            previousBuildEndDateMillis = this._getEndDateMillis(previousBuild),
            currentBuildEndDateMillis = this._getEndDateMillis(currentBuild);

        if (this._isTimeWithinWorkingHours(previousBuildEndDateMillis)) {
            total += this._getWorkingDayEndInMillis(previousBuild) - previousBuildEndDateMillis;
        }
        if (this._isTimeWithinWorkingHours(currentBuildEndDateMillis)) {
            total += currentBuildEndDateMillis - this._getWorkingDayStartInMillis(currentBuild);
        }
        return total;
    },

    _isSpanDuringWorkingHours: function(currentBuildEndDateMillis, previousBuildEndDateMillis) {
        return this._isSameDay(currentBuildEndDateMillis, previousBuildEndDateMillis)
                && this._isTimeWithinWorkingHours(currentBuildEndDateMillis)
                && this._isTimeWithinWorkingHours(previousBuildEndDateMillis);
    },

    _isSameDay: function(date1Millis, date2Millis) {
        var date1 = new Date(date1Millis),
            date2 = new Date(date2Millis);

        return date1.getYear() === date2.getYear()
                && date1.getMonth() === date2.getMonth()
                && date1.getDate() === date2.getDate();
    },

    _isTimeWithinWorkingHours: function(dateMillis) {
        var date = new Date(dateMillis),
            hour = date.getHours();

        if (this._isDateAWorkingDay(date)) //during weekday
	        // 6:00 AM to 5:59:59 PM
	        return hour >= this.START_HOUR && hour < this.END_HOUR;

	 	return false;
    },

    _isDateAWorkingDay: function(date) {
        var day = date.getDay();
        return [1,2,3,4,5].indexOf(day) !== -1;
    },

    _getWorkingDayStartInMillis: function(build) {
        var date = new moment(this._getStartTime(build));
        date.hour(this.START_HOUR);
        date.minute(0);
        date.second(0);

        return date.toDate().getTime();
    },

    _getWorkingDayEndInMillis: function(build) {
        var date = new moment(this._getStartTime(build));
        date.hour(this.END_HOUR);
        date.minute(0);
        date.second(0);

        return date.toDate().getTime();
    },

    _getEndDateMillis: function(build) {
        if (build) {
            return this._getEndTime(build);
        }
    },

    _getStatus: function(build) {
        if (build) {
            var state = build.get('Status');
            if (state === 'SUCCESS') {
                return 'SUCCESS';
            }
            return 'FAILING';
        }
    },

    /**
     * Don't analyze build if build is on the same day as today and today is not yet done.
     * @param currentBuild
     * @return {boolean}
     */
    _shouldAnalyzeBuild: function(currentBuild) {
        var now = new Date(),
            currentHour = now.getHours();

        return !this._isSameDay(now.getTime(), this._getStartTime(currentBuild))
                || currentHour >= this.END_HOUR;
    },

    _getBuildTimeMillis: function(build) {
        return build.get('Duration') * 1000;
    },
    
    _getStartTime: function(build) {
        var buildTime = Date.parse(build.get('Start')),
            timeZoneOffset = new Date().getTimezoneOffset() * 60 * 1000;

        return buildTime + timeZoneOffset;
    },

    _getEndTime: function(build) {
        return this._getStartTime(build) + (build.get('Duration') * 1000);
    },

    _showHoursMinutesSeconds: function(diff) {
        var hours = Math.floor(diff / (1000 * 60 * 60));
        var minutes = Math.floor(diff / (1000 * 60)) % 60;
        var seconds = Math.floor(diff / 1000) % 60;
        var result = '';
        result += (hours > 0) ? this._pluralize('hour', hours) + ", " : "";
        result += (minutes > 0) ? this._pluralize('minute', minutes) : "";
        result += (seconds > 0) ? this._pluralize('second', seconds) : "";
        return result;
    },

    _pluralize: function(val, num) {
        if(num != 1) { val += 's'; }
        return ' ' + num + ' ' + val;
    }

});
                Ext.define('rlm.view.AppPanel', {
    extend: 'Ext.panel.Panel',
    title: 'Query Metrics for a Build',
    alias: 'widget.appPanel',
    layout: {
        type: 'hbox'
    },

    defaults: {
        border: 1
    },
    items: [
        {
            xtype: 'viewoptions'
        },
        {
            xtype: 'rlmresultsdisplay'
        }
    ],

    initComponent: function() {
        this.callParent(arguments);
        this.on('afterrender', this._afterRender, this);
        this.buildData  = Ext.create('rlm.data.BuildData');
    },

    _afterRender: function() {
        this.mon(this.down('viewoptions'), 'submit', this._onOptionsSubmit, this);
    },


    _onOptionsSubmit: function(optionValues) {
        var resultsDisplay = this.down('rlmresultsdisplay'),
            resultsController = Ext.create('rlm.controller.ResultsController');

        this.buildData.query(optionValues).always(function(builds) {
            resultsController.updateResults(builds, resultsDisplay);
        });
    }
});
                Ext.define('rlm.view.BuildDefinitionComboBox', {
    extend: 'Rally.ui.combobox.ComboBox',
    alias: 'widget.builddefinitioncombobox',
    config: {
        fieldLabel: 'Build:',
        minChars: 0,
        defaultSelectionPosition: 'none',
        editable: true,
        queryParam: 'ignoreThisParam',
        autoSelect: false,
        storeConfig: {
            model: 'BuildDefinition',
            context: {
                project: null
            }
        },
        listConfig: {
            loadMask: true,
            deferEmptyText: true,
            cls: 'builddefinition-list'
        }
    },

    setValue: function(value) {
        this.callParent(arguments);
    },

    doQuery: function(queryString, forceAll, rawQuery) {
        var store = this.getStore();

        store.filters.clear();
        store.filters.add(Ext.create('Rally.data.wsapi.Filter', {
            property: 'LastBuild.Start',
            operator: '>',
            value: new moment().subtract('days', 30).format('YYYY-MM-DD')
        }));

        if (!Ext.isEmpty(queryString)) {
            store.filters.add(Ext.create('Rally.data.wsapi.Filter', {
                property: 'Name',
                operator: 'contains',
                value: queryString
            }));
        }

        this.callParent([queryString, forceAll, rawQuery]);
    }

});
                Ext.define('rlm.view.DateRangePicker', {
    extend: 'Ext.Container',
    alias: 'widget.rlmdaterangepicker',

    items: [
        {
            xtype: 'datefield',
            itemId: 'fromDate',
            name: 'fromDate',
            fieldLabel: 'From',
            maxValue: new Date(),
            value: moment().subtract('days', 14).toDate()
        },
        {
            xtype: 'datefield',
            itemId: 'toDate',
            fieldLabel: 'To',
            name: 'toDate',
            maxValue: new Date(),
            value: new Date()
        }
    ],

    getFromDate: function() {
        return this.down('#fromDate').getValue();
    },

    getToDate: function() {
        return this.down('#toDate').getValue();
    }
});
                Ext.define('rlm.view.Options', {
    extend: 'Ext.Container',
    alias: 'widget.viewoptions',
    cls: 'ctr-options',

    items: [
        {xtype: 'builddefinitioncombobox'},
        {xtype: 'rlmdaterangepicker'},
        {
            xtype: 'button',
            itemId: 'submitButton',
            text: 'Submit',
            cls: 'submit-button'
        }
    ],

    initComponent: function() {
        this.callParent(arguments);
        this.addEvents(
            'submit'
        );
        this.on('afterrender', this._onAfterRender, this);
    },

    _onAfterRender: function() {
        this.mon(this.down('#submitButton'), 'click', this._onSubmitButton, this);
    },

    _onSubmitButton: function() {
        this.fireEvent('submit', this._getOptionValues());
    },

    _getOptionValues: function() {
        var buildCombo = this.down('builddefinitioncombobox'),
            dateRangePicker = this.down('rlmdaterangepicker');

        return {
            build: buildCombo.getValue(),
            fromDate: dateRangePicker.getFromDate(),
            toDate: dateRangePicker.getToDate()
        };
    }


});
                Ext.define('rlm.view.ResultsDisplay', {
    extend: 'Ext.Component',
    alias: 'widget.rlmresultsdisplay',
    cls: 'results-display',

    tpl: [
        '<div class="title">Average per working day 6AM - 6PM Mountain Time</div>',
        '<div class="row"><span class="label">Build Time:</span><span class="value">{avgBuildTime}</span></div>',
        '<div class="row"><span class="label">Green light:</span><span class="value"><span class="percent">{avgGreenLightPercent}</span>  ({avgGreenLightTime})  </span></div>',
        '<div class="row"><span class="label">Red light:</span><span class="value"><span class="percent">{avgRedLightPercent}</span> ({avgRedLightTime})</span></div>',
        '<div class="title">Total data</div>',
        '<div class="row"><span class="label">Number of builds:</span><span class="value">{numberOfBuilds}</span></div>',
        '<div class="row"><span class="label">Number of working days:</span><span class="value">{numberOfWorkingDays}</span></div>',
        '<div class="row"><span class="label">Green light time:</span><span class="value">{totalGreenLightTime}</span></div>',
        '<div class="row"><span class="label">Red light time:</span><span class="value">{totalRedLightTime}</span></div>'
    ]
});

            Rally.launchApp('CustomApp', {
                name:"query-builds",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .app .submit-button {
    float: right;
}

.app .title {
    font-weight: bold;
}

.app div, .app label, .app input, .app span, .builddefinition-list li {
    font-size: 14px !important;
}

.app .ctr-options {
    margin: 5px;
}

.app .results-display {
    margin: 5px;
}

.app .results-display span.value {
    float: right;
    font-family: Courier;
}

.app .results-display span.percent {
    font-weight: bold;
}

.app .results-display span.label {
    margin-right: 5px;
    color: #483d8b;
}
    </style>
</head>
<body></body>
</html>
